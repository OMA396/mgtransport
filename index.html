<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>M&G للنقل والشحن</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f7f7f7;
      direction: rtl;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      padding: 2rem;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-bottom: 1rem;
    }
    .card img, .card video, .card iframe {
      width: 100%;
      max-height: 250px;
      object-fit: cover;
    }
    .card-content {
      padding: 1rem;
    }
    .card-content h3 {
      margin: 0;
      font-size: 1.2rem;
      color: #333;
    }
    .card-content p {
      font-size: 1rem;
      color: #666;
    }
    .card-content a {
      display: inline-block;
      margin-top: 0.5rem;
      color: #007BFF;
      text-decoration: none;
    }
    .admin-form {
      background: #fff;
      padding: 1.5rem;
      margin: 2rem auto;
      max-width: 500px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .admin-form input, .admin-form textarea {
      width: 100%;
      padding: 0.8rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-family: 'Cairo', sans-serif;
    }
    .admin-form button {
      background-color: #28a745;
      color: white;
      padding: 0.7rem 1.2rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .delete-btn {
      background-color: red;
      color: white;
      padding: 0.3rem 0.8rem;
      border: none;
      border-radius: 5px;
      margin-top: 0.5rem;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="container">
    <div id="adminFormContainer"></div>
    <h2 style="text-align:center;">📦 منتجاتنا</h2>
    <div id="productGrid"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    // إعدادات Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDnFoa6C2FIxeK06Y1fj0_8u9LyF4ma8sg",
      authDomain: "mgtrasport-53d7e.firebaseapp.com",
      databaseURL: "https://mgtrasport-53d7e-default-rtdb.firebaseio.com",
      projectId: "mgtrasport-53d7e",
      storageBucket: "mgtrasport-53d7e.appspot.com",
      messagingSenderId: "950504597071",
      appId: "1:950504597071:web:eec286bb6103bf0037ec3a"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const params = new URLSearchParams(window.location.search);
    const isAdmin = params.get("admin") === "1234";

    function loadProducts() {
      const grid = document.getElementById("productGrid");
      db.ref("products").on("value", (snapshot) => {
        grid.innerHTML = "";
        snapshot.forEach(child => {
          const data = child.val();
          const id = child.key;
          let media = "";

          if (data.video && data.video.includes("streamable.com")) {
            const videoId = data.video.split("/").pop();
            media = `<iframe src="https://streamable.com/e/${videoId}" frameborder="0" allowfullscreen></iframe>`;
          } else if (data.video) {
            media = `<video controls src="${data.video}"></video>`;
          } else if (data.image) {
            media = `<img src="${data.image}" alt="${data.name}">`;
          }

          grid.innerHTML += `
            <div class="card">
              ${media}
              <div class="card-content">
                <h3>${data.name}</h3>
                <p>${data.description}</p>
                <a href="details.html?name=${encodeURIComponent(data.name)}&desc=${encodeURIComponent(data.description)}&image=${encodeURIComponent(data.image || '')}&video=${encodeURIComponent(data.video || '')}">تفاصيل</a>
                ${isAdmin ? `<button class="delete-btn" onclick="deleteProduct('${id}')">🗑️ حذف</button>` : ""}
              </div>
            </div>
          `;
        });
      });
    }

    function deleteProduct(id) {
      if (confirm("هل تريد حذف هذا المنتج؟")) {
        db.ref("products").child(id).remove()
          .then(() => alert("✅ تم الحذف"))
          .catch(err => alert("❌ خطأ: " + err.message));
      }
    }

    if (isAdmin) {
      document.getElementById("adminFormContainer").innerHTML = `
        <div class="admin-form">
          <h3>➕ إضافة منتج</h3>
          <input id="name" type="text" placeholder="اسم المنتج">
          <input id="image" type="text" placeholder="رابط الصورة (اختياري)">
          <input id="video" type="text" placeholder="رابط الفيديو (اختياري)">
          <textarea id="desc" placeholder="وصف المنتج"></textarea>
          <button onclick="addProduct()">إضافة</button>
        </div>
      `;
    }

    function addProduct() {
      const name = document.getElementById("name").value.trim();
      const image = document.getElementById("image").value.trim();
      const video = document.getElementById("video").value.trim();
      const desc = document.getElementById("desc").value.trim();

      if (!name || !desc) {
        alert("يرجى تعبئة اسم ووصف المنتج");
        return;
      }

      db.ref("products").push({ name, image, video, description: desc }, (err) => {
        if (err) {
          alert("❌ فشل الإضافة: " + err.message);
        } else {
          alert("✅ تم الإضافة!");
          document.getElementById("name").value = "";
          document.getElementById("image").value = "";
          document.getElementById("video").value = "";
          document.getElementById("desc").value = "";
        }
      });
    }

    loadProducts();
  </script>

</body>
</html>
